<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê²€ìƒ‰ ê²°ê³¼ - ì˜¨ë¼ì¸ ì„œì </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .navbar-brand {
      font-weight: bold;
      color: #2c3e50 !important;
    }
    .search-container {
      max-width: 600px;
      margin: 20px auto;
    }
    .search-results-section {
      background-color: #f8f9fa;
      padding: 30px 0;
      min-height: 70vh;
    }
    .book-card {
      transition: transform 0.3s;
      height: 100%;
      border: 1px solid #dee2e6;
    }
    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .book-thumbnail {
      height: 250px;
      object-fit: cover;
      width: 100%;
    }
    .sidebar {
      background-color: #ffffff;
      border-left: 1px solid #dee2e6;
      min-height: 100vh;
      padding: 20px;
    }
    .search-info {
      background-color: #e9ecef;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .book-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .book-author {
      color: #6c757d;
      font-size: 0.9rem;
      margin-bottom: 5px;
    }
    .book-publisher {
      color: #6c757d;
      font-size: 0.85rem;
      margin-bottom: 8px;
    }
    .book-price {
      color: #e74c3c;
      font-weight: bold;
      font-size: 1.1rem;
    }
    .book-description {
      font-size: 0.9rem;
      color: #495057;
      line-height: 1.4;
      max-height: 60px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: #6c757d;
    }
    .no-results i {
      font-size: 4rem;
      margin-bottom: 20px;
      color: #dee2e6;
    }
    .keyword-highlight {
      background-color: #fff3cd;
      padding: 2px 4px;
      border-radius: 3px;
    }
    .popular-keywords {
      margin-bottom: 30px;
    }
    .keyword-rank {
      color: #e74c3c;
      font-weight: bold;
    }
    .banner-item {
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 10px;
      margin-bottom: 10px;
    }

    /* í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
    .pagination-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 40px 0;
      gap: 10px;
    }

    .pagination-info {
      color: #6c757d;
      font-size: 0.9rem;
      margin-right: 20px;
    }

    .custom-pagination {
      display: flex;
      gap: 5px;
    }

    .custom-pagination .page-link {
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 8px 12px;
      color: #495057;
      text-decoration: none;
      transition: all 0.3s;
      min-width: 40px;
      text-align: center;
    }

    .custom-pagination .page-link:hover {
      background-color: #e9ecef;
      border-color: #adb5bd;
    }

    .custom-pagination .page-link.active {
      background-color: #007bff;
      border-color: #007bff;
      color: white;
    }

    .custom-pagination .page-link.disabled {
      color: #6c757d;
      pointer-events: none;
      background-color: #f8f9fa;
    }

    .results-per-page {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .sort-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
  </style>
</head>
<body>
<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<div th:replace="~{common/navigation :: navigation}"></div>

<!-- ê²€ìƒ‰ ì˜ì—­ -->
<div class="container">
  <div class="search-container">
    <form action="/search" method="get" class="d-flex">
      <select name="searchType" class="form-select me-2" style="width: 120px;">
        <option value="all" th:selected="${search.searchType == 'all'}">ì „ì²´</option>
        <option value="title" th:selected="${search.searchType == 'title'}">ì±… ì œëª©</option>
        <option value="author" th:selected="${search.searchType == 'author'}">ì €ì</option>
        <option value="publisher" th:selected="${search.searchType == 'publisher'}">ì¶œíŒì‚¬</option>
      </select>
      <input type="text" name="keyword" class="form-control me-2"
             th:value="${search.keyword}"
             placeholder="ì±… ì œëª©, ì €ì, ì¶œíŒì‚¬ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”" required>
      <button class="btn btn-primary" type="submit">ê²€ìƒ‰</button>
    </form>
  </div>
</div>

<div class="container-fluid">
  <div class="row">
    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="col-md-9">
      <!-- ê²€ìƒ‰ ê²°ê³¼ -->
      <div class="search-results-section">
        <div class="container">
          <!-- ê²€ìƒ‰ ì •ë³´ -->
          <div class="search-info">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h4 class="mb-1">
                  '<span class="keyword-highlight" th:text="${search.keyword}">ê²€ìƒ‰ì–´</span>' ê²€ìƒ‰ ê²°ê³¼
                </h4>
                <p class="mb-0 text-muted">
                  ì´ <strong th:text="${search.searchResult.totalElements ?: 0}">0</strong>ê°œì˜ ì±…ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.
                  <span th:if="${search.searchType != 'all'}" class="ms-2">
                    (<span th:text="${search.searchType == 'title' ? 'ì œëª©' : (search.searchType == 'author' ? 'ì €ì' : 'ì¶œíŒì‚¬')}">ê²€ìƒ‰íƒ€ì…</span> ê²€ìƒ‰)
                  </span>
                </p>
              </div>
              <div class="sort-controls">
                <!-- ì •ë ¬ ì„ íƒ -->
                <select id="sortSelect" class="form-select form-select-sm" style="width: 140px;" onchange="changeSortOption()">
                  <option value="bookPubdate,desc" th:selected="${search.sortProperty == 'bookPubdate' and search.sortDirection == 'DESC'}">ìµœì‹ ìˆœ</option>
                  <option value="bookPubdate,asc" th:selected="${search.sortProperty == 'bookPubdate' and search.sortDirection == 'ASC'}">ì˜¤ë˜ëœìˆœ</option>
                  <option value="bookDiscount,asc" th:selected="${search.sortProperty == 'bookDiscount' and search.sortDirection == 'ASC'}">ê°€ê²© ë‚®ì€ìˆœ</option>
                  <option value="bookDiscount,desc" th:selected="${search.sortProperty == 'bookDiscount' and search.sortDirection == 'DESC'}">ê°€ê²© ë†’ì€ìˆœ</option>
                </select>

                <!-- í˜ì´ì§€ë‹¹ ê°œìˆ˜ ì„ íƒ -->
                <select id="sizeSelect" class="form-select form-select-sm" style="width: 80px;" onchange="changePageSize()">
                  <option value="10" th:selected="${search.pageSize == 10}">10</option>
                  <option value="20" th:selected="${search.pageSize == 20}">20</option>
                  <option value="30" th:selected="${search.pageSize == 30}">30</option>
                </select>
                <span class="text-muted">ê°œ</span>
              </div>
            </div>
          </div>

          <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆëŠ” ê²½ìš° -->
          <div th:if="${not #lists.isEmpty(search.searchResult.content)}" class="row">
            <div class="col-md-4 col-lg-3 mb-4" th:each="book : ${search.searchResult.content}">
              <div class="card book-card h-100">
                <img th:src="${book.bookImage}"
                     th:alt="${book.bookTitle}"
                     class="card-img-top book-thumbnail"
                     onerror="this.src='/images/no-image.png'">
                <div class="card-body d-flex flex-column">
                  <h6 class="book-title" th:text="${book.bookTitle}">ì±… ì œëª©</h6>
                  <p class="book-author" th:text="'ì €ì: ' + ${book.bookAuthor}">ì €ì: ì‘ê°€ëª…</p>
                  <p class="book-publisher" th:text="'ì¶œíŒì‚¬: ' + ${book.bookPublisher}">ì¶œíŒì‚¬: ì¶œíŒì‚¬ëª…</p>

                  <!-- ì¶œê°„ì¼ -->
                  <p class="text-muted small" th:if="${book.bookPubdate}">
                    ì¶œê°„ì¼: <span th:text="${#temporals.format(book.bookPubdate, 'yyyy.MM.dd')}">2024.01.01</span>
                  </p>

                  <!-- ì±… ì„¤ëª… (ê°„ëµ) -->
                  <p class="book-description flex-grow-1" th:if="${book.bookDescription}"
                     th:text="${#strings.abbreviate(book.bookDescription, 100)}">
                    ì±… ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                  </p>

                  <div class="mt-auto">
                    <!-- ê°€ê²© (í• ì¸ê°€ê°€ ìˆëŠ” ê²½ìš°) -->
                    <div th:if="${book.bookDiscount}">
                      <p class="book-price mb-2" th:text="${#numbers.formatInteger(book.bookDiscount, 0, 'COMMA')} + 'ì›'">15,000ì›</p>
                    </div>

                    <div class="d-grid gap-2">
                      <a th:href="'/book/' + ${book.bookId}" class="btn btn-outline-primary btn-sm">ìƒì„¸ë³´ê¸°</a>
                      <a th:href="${book.bookLink}" target="_blank" class="btn btn-primary btn-sm" th:if="${book.bookLink}">
                        êµ¬ë§¤í•˜ê¸°
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
          <div th:if="${not #lists.isEmpty(search.searchResult.content) and search.searchResult.totalPages > 1}" class="pagination-container">
            <div class="pagination-info" th:if="${search.searchResult.totalElements > 0}">
              <span th:text="${search.searchResult.number * search.searchResult.size + 1}">1</span>-<span th:text="${#numbers.formatInteger(search.searchResult.number + 1 < search.searchResult.totalPages ? (search.searchResult.number + 1) * search.searchResult.size : search.searchResult.totalElements, 0, 'COMMA')}">10</span>
              of <span th:text="${#numbers.formatInteger(search.searchResult.totalElements, 0, 'COMMA')}">100</span>
            </div>

            <nav class="custom-pagination" th:with="totalPages=${search.searchResult.totalPages}, currentPage=${search.searchResult.number + 1}, startPage=${T(java.lang.Math).max(1, currentPage - 2)}, endPage=${T(java.lang.Math).min(totalPages, currentPage + 2)}">
              <!-- ì²« í˜ì´ì§€ -->
              <a th:if="${currentPage > 1}"
                 th:href="@{/search(keyword=${search.keyword}, searchType=${search.searchType}, page=0, size=${search.pageSize}, sort=${search.sortProperty + ',' + search.sortDirection})}"
                 class="page-link">
                <i class="fas fa-angle-double-left"></i>
              </a>

              <!-- ì´ì „ í˜ì´ì§€ -->
              <a th:if="${currentPage > 1}"
                 th:href="@{/search(keyword=${search.keyword}, searchType=${search.searchType}, page=${currentPage - 2}, size=${search.pageSize}, sort=${search.sortProperty + ',' + search.sortDirection})}"
                 class="page-link">
                <i class="fas fa-angle-left"></i>
              </a>

              <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ -->
              <span th:each="pageNum : ${#numbers.sequence(startPage, endPage)}">
                <a th:if="${pageNum != currentPage}"
                   th:href="@{/search(keyword=${search.keyword}, searchType=${search.searchType}, page=${pageNum - 1}, size=${search.pageSize}, sort=${search.sortProperty + ',' + search.sortDirection})}"
                   th:text="${pageNum}"
                   class="page-link">1</a>
                <span th:if="${pageNum == currentPage}"
                      th:text="${pageNum}"
                      class="page-link active">1</span>
              </span>

              <!-- ë‹¤ìŒ í˜ì´ì§€ -->
              <a th:if="${currentPage < totalPages}"
                 th:href="@{/search(keyword=${search.keyword}, searchType=${search.searchType}, page=${currentPage}, size=${search.pageSize}, sort=${search.sortProperty + ',' + search.sortDirection})}"
                 class="page-link">
                <i class="fas fa-angle-right"></i>
              </a>

              <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ -->
              <a th:if="${currentPage < totalPages}"
                 th:href="@{/search(keyword=${search.keyword}, searchType=${search.searchType}, page=${totalPages - 1}, size=${search.pageSize}, sort=${search.sortProperty + ',' + search.sortDirection})}"
                 class="page-link">
                <i class="fas fa-angle-double-right"></i>
              </a>
            </nav>
          </div>

          <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš° -->
          <div th:if="${#lists.isEmpty(search.searchResult.content)}" class="no-results">
            <div class="mb-4">
              <i class="fas fa-search"></i>
            </div>
            <h4 class="mb-3">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h4>
            <p class="mb-4">
              '<strong th:text="${search.keyword}">ê²€ìƒ‰ì–´</strong>'ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
              ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.
            </p>
            <div class="mt-4">
              <h6>ê²€ìƒ‰ íŒ:</h6>
              <ul class="list-unstyled text-start" style="max-width: 400px; margin: 0 auto;">
                <li>â€¢ ê²€ìƒ‰ì–´ì˜ ì² ìë¥¼ í™•ì¸í•´ë³´ì„¸ìš”</li>
                <li>â€¢ ë” ê°„ë‹¨í•œ ê²€ìƒ‰ì–´ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”</li>
                <li>â€¢ ê²€ìƒ‰ ë²”ìœ„ë¥¼ 'ì „ì²´'ë¡œ ë³€ê²½í•´ë³´ì„¸ìš”</li>
                <li>â€¢ ì €ìëª…ì´ë‚˜ ì¶œíŒì‚¬ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="col-md-3 sidebar">
      <!-- ì¸ê¸° ê²€ìƒ‰ì–´ -->
      <div class="popular-keywords">
        <h5 class="mb-3">ğŸ”¥ ì¸ê¸° ê²€ìƒ‰ì–´</h5>
        <div class="list-group">
          <div class="d-flex justify-content-between align-items-center p-2">
            <span class="keyword-rank">1</span>
            <a href="/search?keyword=ì†Œì„¤" class="text-decoration-none">ì†Œì„¤</a>
          </div>
          <div class="d-flex justify-content-between align-items-center p-2">
            <span class="keyword-rank">2</span>
            <a href="/search?keyword=ìê¸°ê³„ë°œ" class="text-decoration-none">ìê¸°ê³„ë°œ</a>
          </div>
          <div class="d-flex justify-content-between align-items-center p-2">
            <span class="keyword-rank">3</span>
            <a href="/search?keyword=ê²½ì œ" class="text-decoration-none">ê²½ì œ</a>
          </div>
          <div class="d-flex justify-content-between align-items-center p-2">
            <span class="keyword-rank">4</span>
            <a href="/search?keyword=ì—­ì‚¬" class="text-decoration-none">ì—­ì‚¬</a>
          </div>
          <div class="d-flex justify-content-between align-items-center p-2">
            <span class="keyword-rank">5</span>
            <a href="/search?keyword=ê³¼í•™" class="text-decoration-none">ê³¼í•™</a>
          </div>
        </div>
      </div>

      <!-- ì¶”ì²œ ë„ì„œ -->
      <div class="mb-4">
        <h5 class="mb-3">ğŸ“š ì¶”ì²œ ë„ì„œ</h5>
        <div class="banner-item">
          <h6 class="small">ì˜¤ëŠ˜ì˜ ì¶”ì²œ</h6>
          <p class="small mb-2">ìƒˆë¡œ ì¶œê°„ëœ ë² ìŠ¤íŠ¸ì…€ëŸ¬ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”!</p>
          <a href="/bestseller" class="btn btn-outline-secondary btn-sm">ë”ë³´ê¸°</a>
        </div>
        <div class="banner-item">
          <h6 class="small">ì‹ ê°„ ë„ì„œ</h6>
          <p class="small mb-2">ì´ë²ˆ ì£¼ ìƒˆë¡œ ì¶œê°„ëœ ë„ì„œë“¤</p>
          <a href="/new-books" class="btn btn-outline-secondary btn-sm">ë”ë³´ê¸°</a>
        </div>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ ë°”ë¡œê°€ê¸° -->
      <div class="mb-4">
        <h5 class="mb-3">ğŸ“‹ ì¹´í…Œê³ ë¦¬</h5>
        <div class="d-grid gap-2">
          <a href="/search?searchType=all&keyword=ì†Œì„¤" class="btn btn-outline-primary btn-sm">ì†Œì„¤</a>
          <a href="/search?searchType=all&keyword=ìê¸°ê³„ë°œ" class="btn btn-outline-primary btn-sm">ìê¸°ê³„ë°œ</a>
          <a href="/search?searchType=all&keyword=ê²½ì œê²½ì˜" class="btn btn-outline-primary btn-sm">ê²½ì œ/ê²½ì˜</a>
          <a href="/search?searchType=all&keyword=ì¸ë¬¸í•™" class="btn btn-outline-primary btn-sm">ì¸ë¬¸í•™</a>
          <a href="/search?searchType=all&keyword=ê³¼í•™" class="btn btn-outline-primary btn-sm">ê³¼í•™</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function changeSortOption() {
    const sortSelect = document.getElementById('sortSelect');
    const selectedSort = sortSelect.value;

    const url = new URL(window.location);
    url.searchParams.set('sort', selectedSort);
    url.searchParams.set('page', '0'); // ì •ë ¬ ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™

    window.location.href = url.toString();
  }

  function changePageSize() {
    const sizeSelect = document.getElementById('sizeSelect');
    const selectedSize = sizeSelect.value;

    const url = new URL(window.location);
    url.searchParams.set('size', selectedSize);
    url.searchParams.set('page', '0'); // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™

    window.location.href = url.toString();
  }
</script>
</body>
</html>