<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${book.bookName} + ' - 온라인 서점'">도서 상세 - 온라인 서점</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .navbar-brand {
      font-weight: bold;
      color: #2c3e50 !important;
    }

    .book-detail-section {
      background-color: #f8f9fa;
      padding: 40px 0;
      min-height: 80vh;
    }

    .book-image {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }

    .book-image:hover {
      transform: scale(1.05);
    }

    .book-title {
      font-size: 2rem;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 15px;
      line-height: 1.3;
    }

    .book-author {
      font-size: 1.2rem;
      color: #6c757d;
      margin-bottom: 10px;
    }

    .book-publisher {
      font-size: 1rem;
      color: #6c757d;
      margin-bottom: 15px;
    }

    .book-price {
      font-size: 1.8rem;
      font-weight: bold;
      color: #e74c3c;
      margin-bottom: 20px;
    }

    .book-description {
      font-size: 1rem;
      line-height: 1.6;
      color: #495057;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #007bff;
      margin-bottom: 20px;
    }

    .book-info-table {
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .book-info-table th {
      background-color: #007bff;
      color: white;
      font-weight: 600;
      width: 30%;
      padding: 12px 15px;
      border: none;
    }

    .book-info-table td {
      padding: 12px 15px;
      border-color: #dee2e6;
    }

    .action-buttons {
      margin-top: 30px;
    }

    .action-buttons .btn {
      margin-right: 10px;
      margin-bottom: 10px;
      min-width: 150px;
    }

    /* 주문 버튼 특별 스타일 */
    .btn-order {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      border: none;
      color: white;
      font-weight: bold;
      padding: 12px 30px;
      font-size: 1.1rem;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      transition: all 0.3s ease;
    }

    .btn-order:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
      color: white;
    }

    .breadcrumb-custom {
      background-color: transparent;
      padding: 0;
      margin-bottom: 20px;
    }

    .breadcrumb-custom .breadcrumb-item a {
      color: #007bff;
      text-decoration: none;
    }

    .breadcrumb-custom .breadcrumb-item.active {
      color: #6c757d;
    }

    .badge-info {
      background-color: #17a2b8;
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.8rem;
    }

    .isbn-info {
      font-family: 'Courier New', monospace;
      background-color: #f8f9fa;
      padding: 5px 8px;
      border-radius: 4px;
      border: 1px solid #dee2e6;
    }

    .back-to-search {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 1000;
    }

    .related-section {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-top: 30px;
    }

    @media (max-width: 768px) {
      .book-title {
        font-size: 1.5rem;
      }

      .book-price {
        font-size: 1.4rem;
      }

      .action-buttons .btn {
        width: 100%;
        margin-right: 0;
      }

      .back-to-search {
        bottom: 20px;
        right: 20px;
      }
    }
  </style>
</head>
<body>
<!-- 네비게이션 바 -->
<div th:replace="~{common/navigation :: navigation}"></div>

<!-- 도서 상세 정보 -->
<div class="book-detail-section">
  <div class="container">
    <!-- 브레드크럼 -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb breadcrumb-custom">
        <li class="breadcrumb-item"><a href="/">홈</a></li>
        <li class="breadcrumb-item"><a href="/search">도서 검색</a></li>
        <li class="breadcrumb-item active" aria-current="page" th:text="${book.bookName}">도서명</li>
      </ol>
    </nav>

    <div class="row">
      <!-- 도서 이미지 -->
      <div class="col-lg-4 col-md-5 mb-4">
        <div class="text-center">
          <img th:src="${book.bookImagePath}"
               th:alt="${book.bookName}"
               class="book-image"
               onerror="this.src='/images/no-image.png'">
        </div>
      </div>

      <!-- 도서 정보 -->
      <div class="col-lg-8 col-md-7">
        <!-- 제목 및 기본 정보 -->
        <h1 class="book-title" th:text="${book.bookName}">도서 제목</h1>

        <p class="book-author" th:if="${book.bookAuthor}">
          <i class="fas fa-user me-2"></i>
          <strong>저자:</strong> <span th:text="${book.bookAuthor}">저자명</span>
        </p>

        <p class="book-publisher" th:if="${book.bookPublisher}">
          <i class="fas fa-building me-2"></i>
          <strong>출판사:</strong> <span th:text="${book.bookPublisher}">출판사명</span>
        </p>

        <!-- 가격 정보 -->
        <div class="book-price" th:if="${book.bookDiscount}">
          <i class="fas fa-tag me-2"></i>
          <span th:text="${#numbers.formatInteger(book.bookDiscount, 0, 'COMMA')} + '원'">가격</span>
        </div>

        <!-- 상세 정보 테이블 -->
        <div class="book-info-table">
          <table class="table table-hover mb-0">
            <tbody>
            <tr th:if="${book.bookIsbn}">
              <th scope="row"><i class="fas fa-barcode me-2"></i>ISBN</th>
              <td><span class="isbn-info" th:text="${book.bookIsbn}">ISBN</span></td>
            </tr>
            <tr th:if="${book.bookPubdate}">
              <th scope="row"><i class="fas fa-calendar-alt me-2"></i>출간일</th>
              <td th:text="${#temporals.format(book.bookPubdate, 'yyyy년 MM월 dd일')}">출간일</td>
            </tr>
            <tr th:if="${book.createdAt}">
              <th scope="row"><i class="fas fa-plus-circle me-2"></i>등록일</th>
              <td th:text="${#temporals.format(book.createdAt, 'yyyy-MM-dd HH:mm')}">등록일</td>
            </tr>
            <tr th:if="${book.updatedAt}">
              <th scope="row"><i class="fas fa-edit me-2"></i>수정일</th>
              <td th:text="${#temporals.format(book.updatedAt, 'yyyy-MM-dd HH:mm')}">수정일</td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- 액션 버튼들 -->
        <div class="action-buttons">
          <!-- 주문하기 폼 (POST 방식) - 수정된 부분 -->
          <form action="/order" method="post" style="display: inline-block;">
            <!-- name 속성이 OrderForm의 필드명과 일치해야 함 -->
            <input type="hidden" name="bookId" th:value="${book.bookId}">
            <input type="hidden" name="bookName" th:value="${book.bookName}">
            <input type="hidden" name="bookAuthor" th:value="${book.bookAuthor}">
            <input type="hidden" name="bookPublisher" th:value="${book.bookPublisher}">
            <input type="hidden" name="price" th:value="${book.bookDiscount}">
            <input type="hidden" name="quantity" value="1">
            <button type="submit" class="btn btn-order btn-lg">
              <i class="fas fa-shopping-cart me-2"></i>주문하기
            </button>
          </form>

          <a th:href="${book.bookLink}"
             target="_blank"
             class="btn btn-primary btn-lg"
             th:if="${book.bookLink}">
            <i class="fas fa-external-link-alt me-2"></i>구매하기
          </a>

          <button class="btn btn-outline-secondary btn-lg" onclick="addToWishlist()">
            <i class="fas fa-heart me-2"></i>찜하기
          </button>

          <button class="btn btn-outline-info btn-lg" onclick="shareBook()">
            <i class="fas fa-share-alt me-2"></i>공유하기
          </button>
        </div>
      </div>
    </div>

    <!-- 도서 설명 -->
    <div class="row mt-4" th:if="${book.bookDescription}">
      <div class="col-12">
        <h3><i class="fas fa-book-open me-2"></i>도서 소개</h3>
        <div class="book-description" th:text="${book.bookDescription}">
          도서에 대한 상세한 설명이 여기에 표시됩니다...
        </div>
      </div>
    </div>

    <!-- 관련 도서 섹션 (선택사항) -->
    <div class="row">
      <div class="col-12">
        <div class="related-section">
          <h4><i class="fas fa-books me-2"></i>이런 도서는 어떠세요?</h4>
          <p class="text-muted">같은 저자 또는 유사한 카테고리의 도서들을 추천드립니다.</p>

          <!-- 관련 도서 추천 버튼들 -->
          <div class="mt-3">
            <a th:href="'/search?searchType=author&keyword=' + ${book.bookAuthor}"
               class="btn btn-outline-primary me-2"
               th:if="${book.bookAuthor}">
              같은 저자의 다른 도서
            </a>
            <a th:href="'/search?searchType=publisher&keyword=' + ${book.bookPublisher}"
               class="btn btn-outline-secondary"
               th:if="${book.bookPublisher}">
              같은 출판사의 다른 도서
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 뒤로가기 플로팅 버튼 -->
<div class="back-to-search">
  <button class="btn btn-dark btn-lg rounded-circle" onclick="goBack()" title="뒤로가기">
    <i class="fas fa-arrow-left"></i>
  </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function goBack() {
    if (document.referrer && document.referrer.includes('/search')) {
      history.back();
    } else {
      window.location.href = '/search';
    }
  }

  function addToWishlist() {
    // 찜하기 기능 구현
    alert('찜하기 기능이 추가되었습니다!');
  }

  function shareBook() {
    // 공유하기 기능 구현
    if (navigator.share) {
      navigator.share({
        title: document.title,
        url: window.location.href
      });
    } else {
      // 브라우저에서 Web Share API를 지원하지 않는 경우
      const url = window.location.href;
      navigator.clipboard.writeText(url).then(() => {
        alert('링크가 클립보드에 복사되었습니다!');
      });
    }
  }

  // 페이지 로드시 이미지 로딩 에러 처리
  document.addEventListener('DOMContentLoaded', function() {
    const bookImage = document.querySelector('.book-image');
    if (bookImage) {
      bookImage.addEventListener('error', function() {
        this.src = '/images/no-image.png';
        this.alt = '이미지를 불러올 수 없습니다';
      });
    }
  });
</script>
</body>
</html>

